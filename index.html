<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Joseph Ruscio :: Blog</title>
    <link href='/stylesheets/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <script src='http://ajax.googleapis.com/ajax/libs/mootools/1.2.4/mootools-yui-compressed.js' type='text/javascript'></script>
    <script src='/javascripts/mootools-1.2.4.2-more.js' type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        var twitter_user = "josephruscio"
        var show_replies = false;
        var tweet_count = 3;
      //]]>
    </script>
    <script src='/javascripts/octopress.js' type='text/javascript'></script>
    <script src='/javascripts/twitter.js' type='text/javascript'></script>
    <link href='/atom.xml' rel='alternate' title='Joseph Ruscio' type='application/atom+xml' />
  </head>
  <body id="">
    <div id="header">
      <div class='content'>
        <h1>
          <a class='title' href='/'>Joseph Ruscio</a>
        </h1>
      </div>
    </div>
    <div id="nav">
      <div class='content'>
        <ul>
          <li class='alpha'>
            <a href='/'>Blog</a>
          </li>
          <li class='omega'>
            <a href='/about.html'>About</a>
          </li>
          <li class='subscribe'>
            <a href='/atom.xml'>Subscribe</a>
          </li>
        </ul>
      </div>
    </div>
    <div id="page">
      <div id="content">
        <div id="main">
          <div class="content"><div class="blog">&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/blog/2010/08/19/setting-up-an-apt-repository">Setting up an APT Repository</a></h2>&#x000A;    <div class="meta">&#x000A;       posted: August 19th, 2010&#x000A;      &#x000A;    </div>&#x000A;    <p>I recently set out to create an APT repository to host publicly available&#x000A;packages for <a href="http://librato.com">Librato&#8217;s Silverline</a>. Our users install&#x000A;a tiny agent on their servers and a hosted APT repository provides those&#x000A;using Debian/Ubuntu a configuration management solution superior to&#x000A;manual downloads.</p>&#x000A;&#x000A;<p>Our APT repository must support multiple distributions of both Debian&#x000A;(e.g. Etch, Lenny) and it&#8217;s popular derivative Ubuntu (e.g. Karmic, Lucid).&#x000A;The repository must support both the i386 and x86_64 architectures across&#x000A;all such distributions. A short google search reveals that <code>reprepro</code> is&#x000A;a tool designed for just such a purpose. There are also&#x000A;<a href="http://www.jejik.com/articles/2006/09/setting_up_and_managing_an_apt_repository_with_reprepro/">informative</a>&#x000A;<a href="http://www.danielbond.org/archives/114">reprepro</a> <a href="http://davehall.com.au/blog/dave/2010/02/06/howto-setup-private-package-repository-reprepro-nginx">walkthroughs</a>&#x000A;already online, but they all gloss over some subtle yet extremely&#x000A;important details.</p>&#x000A;&#x000A;<p>So what follows is my attempt to minimally but comprehensively document the&#x000A;procedure assuming a familiarity with shell basics, but little or no experience&#x000A;with Debian packging past <code>apt-get update/upgrade/install</code>.</p>&#x000A;&#x000A;<h3>Host Environment</h3>&#x000A;&#x000A;<p>Our APT repository is hosted on a fresh installation of Ubuntu 10.04 Lucid, but&#x000A;the procedure should work on any recent version of Debian/Ubuntu.</p>&#x000A;&#x000A;<h3>Package Configuration</h3>&#x000A;&#x000A;<p>The most important detail that AFAIK isn&#8217;t covered in any of the tutorials&#x000A;had to do with package naming conventions. The naive assumption (at least&#x000A;on my part) is that you&#8217;ll have a different build of your package for&#x000A;each distro/arch combination, and import them into your repository as such.&#x000A;In other words <code>reprepro</code> should track the distro/arch of each import.&#x000A;In actuality, each build&#8217;s <code>&lt;PACKAGE&gt;_&lt;VERSION&gt;_&lt;ARCH&gt;</code> must be unique, even though&#x000A;you specify the distro during the <code>includedeb</code> operation.</p>&#x000A;&#x000A;<p>To address this requirement there&#8217;s a common practice of appending the&#x000A;distro to the package version e.g. <code>1.0.7</code> becomes <code>1.0.7~lenny1</code> or <code>1.0.7+etch4</code>.&#x000A;(There doesn&#8217;t appear to be a consensus on the joining character.) Adding&#x000A;the second version number after the distro string versions the&#x000A;package itself, enabling updates that only contain changes to the packaging itself.</p>&#x000A;&#x000A;<p>If you do not build your packages to include the distro as part of the version, you&#x000A;will not be able to import a package for more than one distro. You can verify your&#x000A;package was built correctly by inspecting the <code>Version</code> field listed by <code>dpkg -I</code>:</p>&#x000A;&#x000A;<pre><code>ubuntu:~/lenny$ dpkg -I librato_silverline_debian_lenny_5.0.3.x86_64.deb&#x000A; new debian package, version 2.0.&#x000A; size 306916 bytes: control archive= 834 bytes.&#x000A; 255 bytes,     7 lines      conffiles            &#x000A; 277 bytes,    10 lines      control              &#x000A; 991 bytes,    26 lines   *  postinst             #!/bin/sh&#x000A; Package: librato-silverline&#x000A; Version: 2.0.7~lenny&#x000A;...&#x000A;</code></pre>&#x000A;&#x000A;<h3>GnuPG</h3>&#x000A;&#x000A;<p>Assuming you want sign your debian packages to create a secure APT repository,&#x000A;you need a GPG key. If you already have a GPG key you can skip to the next&#x000A;section. Otherwise first ensure that GPG is installed:</p>&#x000A;&#x000A;<pre><code>ubuntu:~$ sudo apt-get install gnupg&#x000A;</code></pre>&#x000A;&#x000A;<p>Create a key with the <code>--gen-key</code> command. Select the defaults and be sure to&#x000A;record the key&#8217;s passphrase, you&#8217;ll need it each time you import a package into&#x000A;the repository:</p>&#x000A;&#x000A;<pre><code>ubuntu:~$ gpg --gen-key&#x000A;</code></pre>&#x000A;&#x000A;<h3>Install and Configure reprepro</h3>&#x000A;&#x000A;<p>Armed with properly configured packages and a GPG key with which to sign them,&#x000A;we&#8217;re now ready to start constructing the repository itself. Start by installing&#x000A;<code>reprepro</code>:</p>&#x000A;&#x000A;<pre><code>ubuntu:-$ sudo apt-get install reprepro&#x000A;</code></pre>&#x000A;&#x000A;<p>Create a directory to serve as the <em>base</em> of the Debian repository. In our setup&#x000A;<code>/var/packages/debian</code> serves as the Debian repository base. In the future&#x000A;<code>/var/packages/ubuntu</code> will house the Ubuntu repository base. We&#8217;ll change ownership&#x000A;of these directories to the <code>ubuntu</code> user that owns the signing key.</p>&#x000A;&#x000A;<pre><code>ubuntu:~$ sudo mkdir /var/packages&#x000A;ubuntu:~$ sudo chown ubuntu:ubuntu /var/packages&#x000A;ubuntu:~$ mkdir /var/packages/debian&#x000A;</code></pre>&#x000A;&#x000A;<p>Each repository needs a top-level <code>conf</code> directory:</p>&#x000A;&#x000A;<pre><code>ubuntu:~$ mkdir /var/packages/debian/conf&#x000A;</code></pre>&#x000A;&#x000A;<p>Create a file named <code>distributions</code> in the <code>conf</code> directory. You&#8217;ll add a set&#x000A;of newline separated configuration blocks (one for each supported distro) to&#x000A;this file. In this example the repository supports <code>etch</code> and <code>lenny</code>. In the future&#x000A;<code>squeeze</code> support could be added with a third block:</p>&#x000A;&#x000A;<pre><code>Origin: Librato, Inc.&#x000A;Label: Librato, Inc.&#x000A;Codename: etch&#x000A;Architectures: i386 amd64&#x000A;Components: non-free&#x000A;Description: Librato APT Repository&#x000A;SignWith: yes&#x000A;DebOverride: override.etch&#x000A;DscOverride: override.etch&#x000A;&#x000A;Origin: Librato, Inc.&#x000A;Label: Librato, Inc.&#x000A;Codename: lenny&#x000A;Architectures: i386 amd64&#x000A;Components: non-free&#x000A;Description: Librato APT Repository&#x000A;SignWith: yes&#x000A;DebOverride: override.lenny&#x000A;DscOverride: override.lenny&#x000A;</code></pre>&#x000A;&#x000A;<p>Fill in the <code>Origin</code>, <code>Label</code>, and <code>Description</code> as you see fit. <code>Codename</code> identifies the&#x000A;distro the block describes and <code>Architectures</code> is self-explanatory (note that <code>sources</code> is a valid arch).&#x000A;<code>Components</code> lists the component of the packages in the repository e.g. for&#x000A;Debian <code>main</code>, <code>contrib</code>, or <code>non-free</code>. <code>DebOverride</code> and <code>DscOverride</code> exceed the scope of&#x000A;this posting, the reader may either research them on their own or set them as shown.</p>&#x000A;&#x000A;<p><code>SignWith</code> instructs <code>reprepro</code> that these packages should be signed. The <code>yes</code>&#x000A;is sufficient as the <code>ubuntu</code> user only has the one key generated above. If&#x000A;you have more than one key you can specify the ID of the signing key with this&#x000A;field.</p>&#x000A;&#x000A;<p>Create empty override files:</p>&#x000A;&#x000A;<pre><code>ubuntu:~$ touch /var/packages/conf/override.etch&#x000A;ubuntu:~$ touch /var/packages/conf/override.lenny&#x000A;</code></pre>&#x000A;&#x000A;<p>Create a file named <code>options</code> in the <code>conf</code> directory and fill it with the&#x000A;following content. This file will store a&#x000A;set of options for <code>reprepro</code> to always run. We only use a few but there are&#x000A;more available on the <code>reprepro</code> manpage.</p>&#x000A;&#x000A;<pre><code>verbose&#x000A;ask-passphrase&#x000A;basedir .&#x000A;</code></pre>&#x000A;&#x000A;<p>The <code>verbose</code> option is self-explanatory. The ask-passphrase option instructs&#x000A;<code>reprepro</code> to ask us for a GPG key passphrase during the import (otherwise&#x000A;it&#8217;ll fail to sign the packages). The <code>basedir .</code> implies that we&#8217;ll be&#x000A;running all of our <code>reprepro</code> commands with the repository base as our&#x000A;working directory:</p>&#x000A;&#x000A;<pre><code>ubuntu:~$ cd /var/packages/debian&#x000A;</code></pre>&#x000A;&#x000A;<h3>Import Packages</h3>&#x000A;&#x000A;<p>The repository base is completely configured and ready for package importing. Just&#x000A;use the <code>includedeb</code> command and specify the correct distro. In our case:</p>&#x000A;&#x000A;<pre><code>ubuntu:/var/packages/debian$ reprepro includedeb etch ~/librato_silverline_debian_etch_4.0r8.x86_64.deb&#x000A;...&#x000A;ubuntu:/var/packages/debian$ reprepro includedeb lenny ~/ubuntu/librato_silverline_debian_lenny_5.0.3.x86_64.deb&#x000A;</code></pre>&#x000A;&#x000A;<p>Each <code>reprepro includedeb</code> operation should prompt for your GPG key passphrase and import the package.</p>&#x000A;&#x000A;<h3>Repository Access</h3>&#x000A;&#x000A;<p>We now have a proper Debian repository and all that remains is making it&#x000A;accessible for installations over the WAN. We just need to serve static&#x000A;files so we&#8217;ll use <code>nginx</code> to serve the packages over HTTP.</p>&#x000A;&#x000A;<pre><code>ubuntu:/var/packages/debian$ sudo apt-get install nginx&#x000A;</code></pre>&#x000A;&#x000A;<p>Configure the APT server in <code>/etc/nginx/sites-available/vhost-packages.conf</code>:</p>&#x000A;&#x000A;<pre><code>server {&#x000A;  listen 80;&#x000A;  server_name apt.librato.com;&#x000A;&#x000A;  access_log /var/log/nginx/packages-error.log;&#x000A;  error_log /var/log/nginx/packages-error.log;&#x000A;&#x000A;  location / {&#x000A;root /var/packages;&#x000A;index index.html;&#x000A;  }&#x000A;&#x000A;  location ~ /(.*)/conf {&#x000A;deny all;&#x000A;  }&#x000A;&#x000A;  location ~ /(.*)/db {&#x000A;deny all;&#x000A;  }&#x000A;}&#x000A;</code></pre>&#x000A;&#x000A;<p>Configure the hash bucket size by creating the file&#x000A;<code>/etc/nginx/conf.d/server_names_hash_bucket_size.conf</code></p>&#x000A;&#x000A;<pre><code>server_names_hash_bucket_size 64;&#x000A;</code></pre>&#x000A;&#x000A;<p>Enable the APT server:</p>&#x000A;&#x000A;<pre><code>ubuntu:/var/packages/debian$ cd /etc/nginx/sites-enabled&#x000A;ubuntu:/etc/nginx/sites-enabled$ sudo ln -s ../sites-available/vhosts-packages.conf .&#x000A;ubuntu:/etc/nginx/sites-enabled$ sudo service nginx start&#x000A;</code></pre>&#x000A;&#x000A;<h3>Enable Public Key Access</h3>&#x000A;&#x000A;<p>Our users will need our public key to validate the signed packages we&#8217;re&#x000A;providing. Placing it in the root of our <code>nginx</code> configuration above&#x000A;makes it accessible with a simple <code>curl</code> invocation:</p>&#x000A;&#x000A;<pre><code>gpg --armor --output /var/packages/packages.librato.key --export apt@librato.com&#x000A;</code></pre>&#x000A;&#x000A;<h3>Installation Test</h3>&#x000A;&#x000A;<p>Now we can test our fully operational APT repository. On some&#x000A;candidate machine log in as root and add our repository to&#x000A;<code>/etc/apt/sources.list</code>:</p>&#x000A;&#x000A;<pre><code>deb http://apt.librato.com/debian/ lenny non-free&#x000A;</code></pre>&#x000A;&#x000A;<p>Import the repository&#8217;s public key:</p>&#x000A;&#x000A;<pre><code>lenny:# curl http://apt.librato.com/packages.librato.key | apt-key add -&#x000A;</code></pre>&#x000A;&#x000A;<p>Fetch the list of packages available at the new source:</p>&#x000A;&#x000A;<pre><code>lenny:# apt-get update&#x000A;</code></pre>&#x000A;&#x000A;<p>Install the hosted package!</p>&#x000A;&#x000A;<pre><code>lenny:# apt-get install librato-silverline&#x000A;</code></pre>&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/blog/2009/12/08/increasing-hard-disk-size-with-lvm-on-vmware-fusion-linux-guest">Increasing hard disk size with LVM on VMWare Fusion Linux guest</a></h2>&#x000A;    <div class="meta">&#x000A;       posted: December 8th, 2009&#x000A;      &#x000A;    </div>&#x000A;    <p>I currently use VMware Fusion to maintain and run a Linux guest on my Macbook.&#x000A;When I originally installed the guest, I assumed that a 20 GB virtual disk&#x000A;would be more than enough space for my Linux hacking.</p>&#x000A;&#x000A;<p>As you can probably infer from the title of this post, some recent developments&#x000A;invalidated that assumption and necessitated more disk space. What follows is a&#x000A;procedure I cobbled together from a bunch of disparate sources that works for my&#x000A;particular setup (VMware Fusion 2.0.4, Fedora 10 guest w/LVM and an ext3&#x000A;filesystem). These instructions involve modifying physical partitions, logical&#x000A;volumes, and your filesystem so I advise you to read through them to the end&#x000A;before getting started.</p>&#x000A;&#x000A;<p>The very first step is to use Fusion to increase the &#8220;physical size&#8221; of the&#x000A;virtual disk. This functionality is accessible through the <em>Virtual Machine&#x000A;-> Hard Disk -> Hard Disk Settings</em> menu item. The resulting dialog contains a&#x000A;<em>Disk size</em> slider. Note that this slider is not accessible unless the VM in&#x000A;question is shut down and (more annoyingly) all pre-existing snapshots are deleted.&#x000A;I just had one snapshot to delete, but it took a while, so be patient. After&#x000A;you&#8217;ve increased the disk size, probably wouldn&#8217;t hurt to take a new snapshot,&#x000A;just in case something goes wrong with the procedure below.</p>&#x000A;&#x000A;<p>Now that we&#8217;ve increased the disk size (I increased mine from 20GB -> 50GB), let&#8217;s&#x000A;boot the VM and log into our guest. We&#8217;ll use the <em>df</em> command to examine our&#x000A;mounted file filesystems:</p>&#x000A;&#x000A;<pre><code>[root@fedora ~]# df -h&#x000A;Filesystem            Size  Used Avail Use% Mounted on&#x000A;/dev/mapper/VolGroup00-LogVol00&#x000A;           18G   15G  1.9G  89% /&#x000A;/dev/sda1             190M  163M   18M  91% /boot&#x000A;tmpfs                 502M   80K  502M   1% /dev/shm&#x000A;</code></pre>&#x000A;&#x000A;<p>Still shows 20 GB of total space and a filesystem device <em>/dev/mapper/VolGroup00-LogVol00</em>&#x000A;that&#8217;s indicative of LVM, the default for Fedora. Use the venerable <em>fdisk</em> to examine&#x000A;the &#8220;physical&#8221; disk:</p>&#x000A;&#x000A;<pre><code>[root@fedora ~]# fdisk -l&#x000A;Disk /dev/sda: 52.6 GB, 52613349376 bytes&#x000A;255 heads, 63 sectors/track, 6396 cylinders&#x000A;Units = cylinders of 16065 * 512 = 8225280 bytes&#x000A;Disk identifier: 0x000f2b12&#x000A;Device    Boot      Start         End      Blocks   Id  System&#x000A;/dev/sda1   *           1          25      200781   83  Linux&#x000A;/dev/sda2              26        2610    20764012+  8e  Linux LVM&#x000A;</code></pre>&#x000A;&#x000A;<p>The physical disk has the capacity, but its in the form of unpartitioned/unformatted space.&#x000A;Before we can do anything, We need to create a new partition containing this space.&#x000A;First we&#8217;ll drop into <em>parted</em> and examine the existing partition table:</p>&#x000A;&#x000A;<pre><code>(parted) print&#x000A;Model: VMware, VMware Virtual S (scsi)&#x000A;Disk /dev/sda: 52.6GB&#x000A;Sector size (logical/physical): 512B/512B&#x000A;Partition Table: msdos&#x000A;Number  Start   End     Size    Type     File system  Flags&#x000A; 1      32.3kB  206MB   206MB   primary  ext3         boot &#x000A; 2      206MB   21.5GB  21.3GB  primary               lvm  &#x000A;</code></pre>&#x000A;&#x000A;<p>Create a new partition that uses up all of the new space on the physical device:</p>&#x000A;&#x000A;<pre><code>(parted) mkpart primary 21.4GB -1s &#x000A;(parted) print&#x000A;Model: VMware, VMware Virtual S (scsi)&#x000A;Disk /dev/sda: 52.6GB&#x000A;Sector size (logical/physical): 512B/512B&#x000A;Partition Table: msdos&#x000A;Number  Start   End     Size    Type     File system  Flags&#x000A; 1      32.3kB  206MB   206MB   primary  ext3         boot &#x000A; 2      206MB   21.5GB  21.3GB  primary               lvm  &#x000A; 3      21.5GB  52.6GB  31.1GB  primary                    &#x000A;</code></pre>&#x000A;&#x000A;<p>Use <em>partprobe</em> to load the table:</p>&#x000A;&#x000A;<pre><code>(parted) quit&#x000A;[root@fedora ~]# partprobe&#x000A;</code></pre>&#x000A;&#x000A;<p>At this point we&#8217;ve got a new partition, <em>/dev/sda3</em>, that you could simply&#x000A;format with <em>mke2fs</em> and mount as its own filesystem e.g. <em>/mnt/data</em>. I&#x000A;personally chose to leverage LVM&#8217;s capabilities and incorporate the new&#x000A;partition into the existing logical volume mounted as /. Start by examining&#x000A;the set of existing physical volumes:</p>&#x000A;&#x000A;<pre><code>[root@fedora ~]# lvm pvs&#x000A;  PV         VG         Fmt  Attr PSize  PFree &#x000A;  /dev/sda2  VolGroup00 lvm2 a-   19.78G 32.00M&#x000A;</code></pre>&#x000A;&#x000A;<p>Create a new physical volume with the new partition:</p>&#x000A;&#x000A;<pre><code>[root@fedora ~]# lvm pvcreate /dev/sda3&#x000A;  Physical volume "/dev/sda3" successfully created&#x000A;[root@fedora ~]# lvm pvs&#x000A;  PV         VG         Fmt  Attr PSize  PFree &#x000A;  /dev/sda2  VolGroup00 lvm2 a-   19.78G 32.00M&#x000A;  /dev/sda3             lvm2 --   29.01G 29.01G&#x000A;</code></pre>&#x000A;&#x000A;<p>Add new physical volume to the volume group. If you recall from the initial&#x000A;<em>df</em> output above, the volume group in question is VolGroup0:</p>&#x000A;&#x000A;<pre><code>[root@fedora ~]# lvm vgextend VolGroup00 /dev/sda3&#x000A;  Volume group "VolGroup00" successfully extended&#x000A;[root@fedora ~]# lvm pvs&#x000A;  PV         VG         Fmt  Attr PSize  PFree &#x000A;  /dev/sda2  VolGroup00 lvm2 a-   19.78G 32.00M&#x000A;  /dev/sda3  VolGroup00 lvm2 a-   29.00G 29.00G&#x000A;</code></pre>&#x000A;&#x000A;<p>Now extend the logical volume to include the physical volume we just added to&#x000A;the group. Use <em>lvm vgdisplay</em> to examine the group:</p>&#x000A;&#x000A;<pre><code>[root@fedora ~]# lvm vgdisplay VolGroup00&#x000A;  --- Volume group ---&#x000A;  VG Name               VolGroup00&#x000A;  System ID&#x000A;  Format                lvm2&#x000A;  Metadata Areas        2&#x000A;  Metadata Sequence No  4&#x000A;  VG Access             read/write&#x000A;  VG Status             resizable&#x000A;  MAX LV                0&#x000A;  Cur LV                2&#x000A;  Open LV               2&#x000A;  Max PV                0&#x000A;  Cur PV                2&#x000A;  Act PV                2&#x000A;  VG Size               48.78 GB&#x000A;  PE Size               32.00 MB&#x000A;  Total PE              1561&#x000A;  Alloc PE / Size       632 / 19.75 GB&#x000A;  Free  PE / Size       929 / 29.03 GB&#x000A;  VG UUID               8w2Wi9-T2lV-IKCV-fLRP-yTJl-teJM-LuGoNb&#x000A;</code></pre>&#x000A;&#x000A;<p>The <em>Free PE/Size</em> field shows the new physical volume as 929 free extents.&#x000A;Extend the logical volume to include all free extents:</p>&#x000A;&#x000A;<pre><code>[root@fedora ~]# lvm lvextend -l+929 /dev/VolGroup00/LogVol00&#x000A;  Extending logical volume LogVol00 to 46.81 GB&#x000A;  Logical volume LogVol00 successfully resized&#x000A;</code></pre>&#x000A;&#x000A;<p>Use <em>resize2fs</em> to extend our ext3 filesystem online. Note that many LVM&#x000A;tutorials online refer to the now deprecated <em>ext2online</em> command for this&#x000A;step, <em>resize2fs</em> now provides this functionality:</p>&#x000A;&#x000A;<pre><code>root@fedora ~]# resize2fs /dev/VolGroup00/LogVol00 &#x000A;resize2fs 1.41.4 (27-Jan-2009)&#x000A;Filesystem at /dev/VolGroup00/LogVol00 is mounted on /; on-line resizing required&#x000A;old desc_blocks = 2, new_desc_blocks = 3&#x000A;Performing an on-line resize of /dev/VolGroup00/LogVol00 to 12271616 (4k) blocks.&#x000A;The filesystem on /dev/VolGroup00/LogVol00 is now 12271616 blocks long.&#x000A;</code></pre>&#x000A;&#x000A;<p>Finally, use <em>df</em> again to verify that we have lots of free space:</p>&#x000A;&#x000A;<pre><code>[root@fedora ~]# df -h&#x000A;Filesystem            Size  Used Avail Use% Mounted on&#x000A;/dev/mapper/VolGroup00-LogVol00&#x000A;           47G   15G   29G  34% /&#x000A;/dev/sda1             190M  163M   18M  91% /boot&#x000A;tmpfs                 502M   80K  502M   1% /dev/shm&#x000A;</code></pre>&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/blog/2009/09/13/aggregate-statistics-gem-released">Aggregate statistics gem released!</a></h2>&#x000A;    <div class="meta">&#x000A;       posted: September 13th, 2009&#x000A;      &#x000A;    </div>&#x000A;    <p>Finally got around to putting together a decent README (and a few last bugfixes)&#x000A;for my Aggregate statistics gem. With that out of the way, its ready for&#x000A;public consumption. Aggregate is an easy-to-use ruby implementation of a&#x000A;statistics aggregator that includes configurable histogram (binary or linear)&#x000A;support. Stats are aggregated in a <em>streaming</em> fashion that doesn&#8217;t record/store&#x000A;any of the individual sample values, enabling statistics tracking across a&#x000A;practically unlimited number of samples without any impact on your application&#8217;s&#x000A;performance or memory footprint.</p>&#x000A;&#x000A;<p>Perhaps more importantly than the basic aggregate statistics (e.g. mean,&#x000A;standard deviation, max, min, etc) Aggregate also maintains a histogram of the&#x000A;sample distribution. For anything other than normally distributed data averages&#x000A;are insufficient at best and often downright misleading. 37Signals recently&#x000A;posted a&#x000A;<a href="http://37signals.com/svn/posts/1836-the-problem-with-averages">terse but effective explanation</a>&#x000A;on the importance of histograms. Here&#8217;s a second more&#x000A;<a href="http://www.zedshaw.com/essays/programmer_stats.html">detailed posting</a> by Zed&#x000A;Shaw authored in his inimitable and entertaining style.</p>&#x000A;&#x000A;<p>Full source code and a detailed README can be found on the&#x000A;<a href="http://github.com/josephruscio/aggregate">project homepage</a> and the gem is&#x000A;available on <a href="http://www.gemcutter.org/gems/aggregate">gemcutter.org</a>.&#x000A;But just to whet your appetite, here&#8217;s a quick example:</p>&#x000A;&#x000A;<pre><code>require 'rubygems'&#x000A;require 'aggregate'&#x000A;&#x000A;# Create an Aggregate instance&#x000A;binary_aggregate = Aggregate.new&#x000A;linear_aggregate = Aggregate.new(0, 65536, 8192)&#x000A;&#x000A;65536.times do&#x000A;  x = rand(65536)&#x000A;  binary_aggregate &gt;&gt; x&#x000A;  linear_aggregate &gt;&gt; x&#x000A;end&#x000A;&#x000A;puts "\n** Binary Histogram **\n%s" % [binary_aggregate.to_s]&#x000A;puts "\n** Linear Histogram **\n%s" % [linear_aggregate.to_s]&#x000A;</code></pre>&#x000A;&#x000A;<p>And the resulting output:</p>&#x000A;&#x000A;<pre><code>macbook:aggregate(master) jruscio$ ruby ./aggregate_example.rb &#x000A;&#x000A;** Binary Histogram **&#x000A;value |------------------------------------------------------------------| count&#x000A;    1 |                                                                  |     1&#x000A;    2 |                                                                  |     1&#x000A;    4 |                                                                  |     2&#x000A;    8 |                                                                  |    10&#x000A;   16 |                                                                  |    24&#x000A;   32 |                                                                  |    33&#x000A;   64 |                                                                  |    71&#x000A;  128 |                                                                  |   121&#x000A;  256 |                                                                  |   258&#x000A;  512 |@                                                                 |   497&#x000A; 1024 |@@                                                                |  1061&#x000A; 2048 |@@@@                                                              |  2004&#x000A; 4096 |@@@@@@@@                                                          |  4186&#x000A; 8192 |@@@@@@@@@@@@@@@@                                                  |  8257&#x000A;16384 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                                 | 16345&#x000A;32768 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@| 32665&#x000A;  ~&#x000A;Total |------------------------------------------------------------------| 65536&#x000A;&#x000A;** Linear Histogram **&#x000A;value |------------------------------------------------------------------| count&#x000A;    0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ |  8269&#x000A; 8192 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ |  8257&#x000A;16384 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ |  8302&#x000A;24576 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   |  8043&#x000A;32768 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ |  8273&#x000A;40960 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   |  8052&#x000A;49152 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@|  8315&#x000A;57344 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   |  8025&#x000A;Total |------------------------------------------------------------------| 65536&#x000A;</code></pre>&#x000A;&#x000A;<p>Feedback welcome and enjoy!</p>&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/blog/2009/07/29/installing-git-on-centos-5-2">Installing git on CentOS 5.2</a></h2>&#x000A;    <div class="meta">&#x000A;       posted: July 29th, 2009&#x000A;      &#x000A;    </div>&#x000A;    <p><a href="http://www.centos.org/">CentOS</a> for all intents and purposes is a community&#x000A;supported clone of Red Hat Enterprise Linux (RHEL). If you want to run RHEL&#x000A;without paying for support, CentOS is as good as it gets. One of the hallmarks&#x000A;of Enterprise Linux distributions is their rock-steady stability i.e. they only&#x000A;run really boring, old software. This risk-aversion has a downside in restricted&#x000A;access to the latest and greatest packages and tools. Case in point, since Red&#x000A;Hat released RHEL 5.0 in March 2007, Git has really matured from its origins as&#x000A;a custom kernel development tool into a version control world-beater. Unfortunately&#x000A;the base CentOS 5.2 repositories don&#8217;t appear to contain rpms for git. Or at&#x000A;least the CentOS 5.2 AMI I&#8217;m using (ami-e300e68a) doesn&#8217;t:</p>&#x000A;&#x000A;<pre><code>-bash-3.2# yum install git&#x000A;Loading "fastestmirror" plugin&#x000A;Loading mirror speeds from cached hostfile&#x000A;... [snip] ...&#x000A;No package git available.&#x000A;Nothing to do&#x000A;</code></pre>&#x000A;&#x000A;<p>Not to fear, <a href="https://rpmrepo.org/RPMforge" title="">RPMforge</a> maintains an RPM&#x000A;repository for CentOS full of goodies, including git (1.5.x as of this writing).&#x000A;The CentOS Wiki provides&#x000A;<a href="http://wiki.centos.org/AdditionalResources/Repositories/RPMForge?action=show&amp;amp;redirect=Repositories%2FRPMForge#head-b06dd43af4eb366c28879a551701b1b5e4aefccd" title="">detailed instructions</a> on configuring RPMforge access, but here&#8217;s the rapid-fire how-to.</p>&#x000A;&#x000A;<p>Install <em>priorities</em> to avoid conflicts between packages in RPMforge and the&#x000A;Base CentOS repositories:</p>&#x000A;&#x000A;<pre><code>-bash-3.2# yum install yum-priorities&#x000A;... [snip] ...&#x000A;Installed: yum-priorities.noarch 0:1.1.16-13.el5.centos&#x000A;Complete!&#x000A;</code></pre>&#x000A;&#x000A;<p>To configure priorities first edit <em>/etc/yum.repos.d/CentOS-Base.repo</em> and add&#x000A;a <em>priority=N</em> line to each entry. For [base], [updates], [addons], and&#x000A;[extras] set <em>N</em> to 1. For [centosplus] set <em>N</em> to 2. Also edit&#x000A;<em>/etc/yum.repos.d/rpmforge.repo</em> and for [rpmforge] set <em>N</em> > 2.&#x000A;(I chose 4 because its the next power of 2, and that&#8217;s how I roll).</p>&#x000A;&#x000A;<p>Verify our access to RPMforge with a check-update:</p>&#x000A;&#x000A;<pre><code>-bash-3.2# yum check-update |grep forge&#x000A;* rpmforge: ftp-stud.fht-esslingen.de&#x000A;... [snip] ...&#x000A;</code></pre>&#x000A;&#x000A;<p>Finally install git:</p>&#x000A;&#x000A;<pre><code>-bash-3.2# yum install git&#x000A;... [snip] ...&#x000A;Complete!&#x000A;</code></pre>&#x000A;&#x000A;<p>Enjoy the tasty DVCS goodness!</p>&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/blog/2009/07/28/kvm-on-fedora-11-quickstart-guide">KVM on Fedora 11 QuickStart Guide</a></h2>&#x000A;    <div class="meta">&#x000A;       posted: July 28th, 2009&#x000A;      &#x000A;    </div>&#x000A;    <p>With the upcoming release of RHEL 5.4, Red Hat officially enters the&#x000A;virtualization fray with a KVM-based solution. Although KVM is exciting for&#x000A;several reasons, e.g. it&#8217;s free, fully supported by the Linux kernel community,&#x000A;doesn&#8217;t require any special hardware past the increasingly common Intel-VT or&#x000A;AMD-V extensions, etc, its also represents the next stage of virtualization evolution.</p>&#x000A;&#x000A;<p>I&#8217;ll expound in a future post about how and why (admittedly with the benefit of&#x000A;hindsight) KVM represents a far more elegant model for virtualization, but&#x000A;after the jump today you&#8217;ll find a minimal set of instructions to rapidly get a&#x000A;Debian Lenny virtual guest up and running on a fresh out-of-the-box Fedora 11&#x000A;server installation.</p>&#x000A;&#x000A;<p>Lengthy instructions on Fedora virtualization suitable for KVM and/or Xen can&#x000A;be found at&#x000A;<a href="http://fedoraproject.org/wiki/Virtualization_Quick_Start#Using_virtualization_on_fedora">the Fedora wiki</a>&#x000A;The following lists the minimal set of steps to get a guest running focusing&#x000A;soley on KVM to the exclusion of Xen.</p>&#x000A;&#x000A;<p>Our setup comprises a freshly installed remote Fedora 11 server serving as the&#x000A;KVM target (bash prompt <em>server</em>) and a local Fedora 11 laptop (bash prompt <em>laptop</em>).</p>&#x000A;&#x000A;<p>First we&#8217;ll shell into the remote server to install and configure all the&#x000A;necessary KVM software. Verify we&#8217;re using Fedora 11 with a Intel-VT or AMD-V&#x000A;processor:</p>&#x000A;&#x000A;<pre><code>[root@server ~]# uname -a &amp;&amp; egrep '(vmx|svm)' /proc/cpuinfo | wc -l&#x000A;Linux server 2.6.29.4-167.fc11.x86_64 #1 SMP Wed May 27 17:27:08 EDT 2009 x86_64 x86_64 x86_64 GNU/Linux&#x000A;4&#x000A;</code></pre>&#x000A;&#x000A;<p>This server is running the modified 2.6.29 Linux kernel that comes stock with&#x000A;Fedora Core 11. It possesses 4 processing cores enabled with Intel-VT. Installing&#x000A;the basic tools required for KVM is our first task, luckily Fedora provides a&#x000A;convenient meta-package:</p>&#x000A;&#x000A;<pre><code>[root@server ~]# yum groupinstall 'Virtualization'&#x000A;</code></pre>&#x000A;&#x000A;<p>Alongside kvm/qemu, the Virtualization group also includes the&#x000A;<a href="http://libvirt.org/">libvirt</a> toolset. Libvirt provides a common abstraction&#x000A;across several types of hypervisors. This abstraction includes simplified&#x000A;installation and remote graphical console access a la $VMW&#8217;s VirtualCenter. To&#x000A;access these features we must start the libvirtd daemon.</p>&#x000A;&#x000A;<pre><code>[root@server ~]# /etc/init.d/libvirtd start&#x000A;Starting libvirtd daemon:                                  [  OK  ]&#x000A;</code></pre>&#x000A;&#x000A;<p>Using the <em>virsh</em> command line tool, verify the currently guestless system is&#x000A;running and ready to accept commands:</p>&#x000A;&#x000A;<pre><code>[root@server ~]# virsh -c qemu:///system list&#x000A;Id Name                 State&#x000A;----------------------------------&#x000A;</code></pre>&#x000A;&#x000A;<p>Now we&#8217;re ready to install our guest. We&#8217;ll need to download an ISO image to&#x000A;install our virtual machine. To keep things simple we&#8217;ll go with Debian Stable&#x000A;aka <em>Lenny</em> (as of this writing). We&#8217;ll create a top-level directory to store&#x000A;both the ISO image and the virtual machine disk image:</p>&#x000A;&#x000A;<pre><code>[root@server ~]# mkdir /kvm &amp;&amp; cd /kvm&#x000A;[root@server kvm]# wget http://cdimage.debian.org/debian-cd/5.0.2/amd64/iso-cd/debian-502-amd64-netinst.iso&#x000A;...&#x000A;[snip]&#x000A;...&#x000A;Saving to: `debian-502-amd64-netinst.iso.1'&#x000A;100%[==================================================================================================&gt;] 137,713,664 1.49M/s in 93s&#x000A;2009-07-27 19:10:24 (1.56 MB/s) - `debian-502-amd64-netinst.iso' saved [137713664/137713664]&#x000A;</code></pre>&#x000A;&#x000A;<p>Now armed with the KVM/libvirt tools and an ISO image for installation, we issue&#x000A;a single <em>virt-install</em> command to a) create a backing disk image and b) boot&#x000A;a newly created virtual guest off of the ISO:</p>&#x000A;&#x000A;<pre><code>root@server kvm]# virt-install --connect qemu:///system -n lenny0 \&#x000A;&gt; -r 512 --disk path=/kvm/lenny0.qcow2,size=16 \&#x000A;&gt; -c /kvm/debian-502-amd64-netinst.iso --noautoconsole --os-type linux \&#x000A;&gt; --os-variant debianlenny --accelerate --hvm&#x000A;&#x000A;Starting install...&#x000A;Creating storage file...  |  16 GB     00:00&#x000A;Creating domain...        |    0 B     00:01&#x000A;Domain installation still in progress. You can reconnect to the console to complete the installation process.&#x000A;</code></pre>&#x000A;&#x000A;<p>The &#8220;domain&#8221; referred to in virt-install&#8217;s output is our new guest. We&#8217;ve&#x000A;created a single-core virtual server named lenny0 with 512 MB of RAM and a 16GB&#x000A;virtual disk housed on server at /kvm/lenny0.qcow2. Furthermore, lenny0 has been&#x000A;booted off of our Debian net-install ISO image.</p>&#x000A;&#x000A;<p>Now we can use the graphical <em>virt-manager</em> tool locally from our laptop to&#x000A;connect to the virtual server&#8217;s graphical console (basically VNC) and kick off&#x000A;the Debian net-install process. In theory we should be able to run virt-manager&#x000A;locally on our laptop and connect over ssh to the libvirtd daemon on the remote&#x000A;server. In practice it&#8217;s still pretty shaky and has some onerous requirements.&#x000A;Notably that there&#8217;s no progress indicator informing how much longer remains&#x000A;before the connection initializes (and it takes a long time). So if you want&#x000A;to try it out, <a href="http://virt-manager.org/page/RemoteSSH" title="">good luck</a>, YMMV&#x000A;(hopefully someone at $RHAT puts some polish on this aspect soon).</p>&#x000A;&#x000A;<p>I&#8217;ve personally chosen to avoid the whole debacle and just run virt-manager on&#x000A;the remote server and use X Forwarding over ssh to interact with it from the&#x000A;laptop. It&#8217;s slow, but sufficient for Debian&#8217;s curses-based installer&#x000A;(I actually did this across the continental US).</p>&#x000A;&#x000A;<pre><code>fedora:lm jruscio$ ssh -X root@server 'virt-manager' &amp;amp;&#x000A;[1] 20038&#x000A;</code></pre>&#x000A;&#x000A;<p>The virt-manager tool should show a single VM, lenny0, running on server.&#x000A;Double-clicking on the lenny0 entry brings up the VNC console, that should show&#x000A;the Debian net-install splash screen. Start the installation and for the most&#x000A;part select all the defaults (I removed <em>Desktop</em> from the additional packages).</p>&#x000A;&#x000A;<p>After the installer finishes it leaves the machine in a halted state. Boot the&#x000A;machine with the <em>Run</em> button above the VNC console and log in as root. As a&#x000A;final step install ssh and use ifconfig to determine the IP address DHCP granted&#x000A;the virtual server:</p>&#x000A;&#x000A;<pre><code>lenny0:~# apt-get install ssh&#x000A;[snip]&#x000A;lenny0:~# ifconfig eth0 |grep inet&#x000A;      inet addr:192.168.122.99  Bcast:192.168.122.255  Mask:255.255.255.0&#x000A;      inet6 addr: fe80::5652:ff:fe46:6f93/64 Scope:Link&#x000A;</code></pre>&#x000A;&#x000A;<p>That was pretty easy and we&#8217;re now able to shell into our virtual guest from&#x000A;the physical server hosting it!:</p>&#x000A;&#x000A;<pre><code>server:~ jruscio$ ssh 192.168.122.99&#x000A;jruscio@192.168.122.99's password:&#x000A;Linux lenny0 2.6.26-2-amd64 #1 SMP Sun Jun 21 04:47:08 UTC 2009 x86_64&#x000A;</code></pre>&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/blog/2009/07/16/securing-your-online-identity">Securing your online identity</a></h2>&#x000A;    <div class="meta">&#x000A;       posted: July 16th, 2009&#x000A;      &#x000A;    </div>&#x000A;    <p>This week a&#x000A;<a href="http://www.mercurynews.com/topstories/ci_12844562">widely publicized security breach</a>&#x000A;occurred at media darling Twitter. The cracker made off with a slew of internal&#x000A;company documents, most of which are now easily located at your technology news&#x000A;site of choice. It&#8217;s somewhat of a tempest in a teapot, given that most of the&#x000A;secret documents reveal such salacious details such as Twitter&#8217;s desire to make&#x000A;money and grow. Shocking, I know.</p>&#x000A;&#x000A;<p>What should should concern the average net denizen (you, me, etc), is the&#x000A;attack vector used to compromise Twitter. In a similar fashion to what&#x000A;<a href="http://www.wired.com/threatlevel/2008/09/palin-e-mail-ha/">befell Sarah Palin</a>&#x000A;during the last election, the cracker managed to compromise a personal&#x000A;web-based email account of a handful of Twitter employees or their family (Gmail&#x000A;in this case, Yahoo for Sarah Palin). After gaining access to Gmail accounts,&#x000A;the cracker was able to both access other online accounts, any attached documents,&#x000A;or Google Docs repositories.</p>&#x000A;&#x000A;<p>You see, almost any website you log into will gladly email you everything you&#x000A;need to access your account through a simple click of the &#8220;Forgot my password&#8221;&#x000A;button. So even assuming you have a unique, strong password set on every account&#x000A;(and lets be honest, you don&#8217;t), once a cracker gains access to your favorite&#x000A;email account, its game over.</p>&#x000A;&#x000A;<p>And what industrial strength security mechanism do email providers use to&#x000A;protect your online achilles heel? Some simple question that&#8217;s ridiculously&#x000A;susceptible to attacks. (What&#8217;s your mother&#8217;s maiden name? What town did you go&#x000A;to high school in? What kind of car do you drive?) So while IANASE (I Am Not A&#x000A;Security Expert), and you need to take responsibility for securing your&#x000A;identity online, there are a few simple things you can do to drastically&#x000A;increase your safety.</p>&#x000A;&#x000A;<p>Even if you&#8217;re not going to use a unique, random password for each account&#x000A;(and you should), at least secure your online email accounts or any Single&#x000A;Sign-on (e.g. OpenID) with a unique, random password. Furthermore, if you have&#x000A;the opportunity to select your own security question (Gmail at least permits&#x000A;this), you should use a question along the lines of &#8220;What is the answer to my&#x000A;security question?&#8221; and supply as that answer a highly-randomized, secure&#x000A;password that you record and store somewhere safe. FYI, a post-it note affixed&#x000A;to your monitor is not such a safe location. Alternatively you could just&#x000A;answer one of the silly questions with your random password.</p>&#x000A;&#x000A;<p>(For those looking for more ubiquitous protection,&#x000A;<a href="http://agilewebsolutions.com/products/a/1Password">1Password</a> is a highly-touted,&#x000A;secure password manager that seamlessly integrates with your web-browser to&#x000A;maintain a full set of unique, bulletproof passwords.)</p>&#x000A;  </div>&#x000A;  <div class="article">&#x000A;    <h2><a class="title" href="/blog/2009/07/15/hello-world">printf(&#8220;Hello World!\n&#8221;);</a></h2>&#x000A;    <div class="meta">&#x000A;       posted: July 15th, 2009&#x000A;      &#x000A;    </div>&#x000A;    <p>Welcome to my blog. I&#8217;m only about 10 years behind the times, but better late&#x000A;than never I suppose. In my defense, the need for a place for musings and&#x000A;information too long for Twitter (<a href="http://twitter.com/josephruscio">@josephruscio</a>)&#x000A;served as the main motivator.&#x000A;Look in this space for intermittent postings on software development, computer&#x000A;science, startupping, marathon training, food/drink, or whatever other shiny&#x000A;object has my attention.</p>&#x000A;  </div>&#x000A;  <div class="footer">&#x000A;    <a href="/archives.html" title="archives">&laquo; Blog Archives</a>&#x000A;  </div>&#x000A;</div></div>
        </div>
        <div id="sidebar">
          <h4>Twitter <a class="small" href="http://twitter.com/josephruscio">@josephruscio</a></h4>
          <div id='twitter'>
            <ul id='twitter_status'>
              Status updating...
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div id='footer'>
      <div class='content'>
        Copyright &copy; 2009 to 2010 - Joseph Ruscio -
        <span class='credit'>Powered by <a href="http://octopress.org">Octopress</a></span>
      </div>
    </div>
    
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18008905-1']);
        _gaq.push(['_trackPageview']);
        
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
        })();
      //]]>
    </script>
  </body>
</html>
